description: >
  Command for spin up test environment using docker compose and run tests

parameters:
  container:
    type: string
    default: "web"
    description: "Application container name"
  env-file:
    type: string
    default: ".env"
    description: "env file path"
  run-command:
    type: string
    default: "npm run test"
    description: "Command for run tests inside docker-compose environment"

steps:
  - run:
      command: |
        #!/bin/bash
        docker-compose up --build --env-file ${PARAM_ENV_FILE}
        docker-compose run --rm ${PARAM_CONTAINER} ${PARAM_RUN_COMMAND}

      environment:
        PARAM_CONTAINER: <<parameters.container>>
        PARAM_ENV_FILE: <<parameters.env-file>>
        PARAM_RUN_COMMAND: <<parameters.run-command>>
